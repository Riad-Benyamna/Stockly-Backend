# ğŸ“Š Stockly Backend - Authentication & Analysis API

Node.js/Express backend for the Stockly Chrome extension. Handles Google OAuth authentication, user management, and AI-powered stock/crypto analysis. Deployed on Railway with PostgreSQL database.

---

## ğŸš€ What This Is

This is the **backend API** for the Stockly Chrome extension. It provides:

- **User Authentication** via Google OAuth 2.0
- **Token-based Authorization** for API requests
- **Stock Analysis** using OpenRouter AI, NewsAPI, and Alpha Vantage
- **Crypto Analysis** using CoinGecko API
- **PostgreSQL Database** for user data storage

The frontend Chrome extension communicates with this backend to authenticate users and retrieve stock analysis.

---

## ğŸ—ï¸ Architecture
```
Chrome Extension (Frontend)
         â”‚
         â”‚ POST /auth/google
         â”‚ POST /analyze
         â–¼
    This Backend
    (server.js)
         â”‚
         â”œâ”€â†’ Google OAuth (Token Verification)
         â”œâ”€â†’ PostgreSQL (User Storage)
         â”œâ”€â†’ OpenRouter API (AI Analysis)
         â”œâ”€â†’ NewsAPI (Headlines)
         â”œâ”€â†’ Alpha Vantage (Stock Prices)
         â””â”€â†’ CoinGecko (Crypto Data)
```

---

## ğŸ› ï¸ Tech Stack

- **Runtime:** Node.js 18+
- **Framework:** Express.js
- **Database:** PostgreSQL (with `pg` driver)
- **Authentication:** Google OAuth 2.0
- **External APIs:**
  - OpenRouter (AI analysis)
  - NewsAPI (news headlines)
  - Alpha Vantage (stock prices)
  - CoinGecko (crypto data)

---

## ğŸ“ Files
```
stockly-backend/
â”œâ”€â”€ server.js          # Main backend application
â”œâ”€â”€ package.json       # Dependencies
â”œâ”€â”€ Procfile          # Railway deployment config
â”œâ”€â”€ .gitignore        # Git ignore rules
â””â”€â”€ README.md         # This file
```

---

## ğŸ“Š API Endpoints

### **POST `/auth/google`**
Authenticate user with Google OAuth token.

**Request:**
```json
{
  "idToken": "google_jwt_token_here"
}
```

**Response:**
```json
{
  "success": true,
  "user": {
    "id": 1,
    "email": "user@example.com",
    "name": "John Doe",
    "picture": "https://...",
    "token": "unique_auth_token"
  }
}
```

---

### **POST `/auth/verify`**
Verify authentication token validity.

**Request:**
```json
{
  "token": "user_auth_token"
}
```

**Response:**
```json
{
  "valid": true,
  "user": {
    "id": 1,
    "email": "user@example.com",
    "name": "John Doe",
    "picture": "https://..."
  }
}
```

---

### **POST `/analyze`**
Analyze a stock or cryptocurrency (requires authentication).

**Request:**
```json
{
  "ticker": "AAPL",
  "isCrypto": false,
  "token": "user_auth_token"
}
```

**Response:**
```json
{
  "result": "<html>...formatted analysis widget...</html>"
}
```

Returns HTML widget containing:
- Current price & change
- News sentiment score
- Technical indicators
- AI-generated market analysis
- Research checklist

---

## ğŸ”‘ Environment Variables

Required variables (set in Railway dashboard):
```bash
# API Keys
OPENROUTER_API_KEY=sk-or-v1-...
NEWS_API_KEY=...
ALPHA_VANTAGE_KEY=...

# Google OAuth
GOOGLE_CLIENT_ID=123456789-abc.apps.googleusercontent.com

# Database (auto-generated by Railway)
DATABASE_URL=postgresql://user:pass@host:port/db

# Environment
NODE_ENV=production
PORT=8080  # Auto-assigned by Railway
```

---

## ğŸ—„ï¸ Database Schema

### **`users` table:**
```sql
CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  email VARCHAR(255) UNIQUE NOT NULL,
  name VARCHAR(255),
  picture VARCHAR(500),
  google_id VARCHAR(255) UNIQUE,
  auth_token VARCHAR(255) UNIQUE NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  last_login TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_users_token ON users(auth_token);
CREATE INDEX idx_users_email ON users(email);
```

The table is **auto-created** on server startup if it doesn't exist.

---

## ğŸš€ Deployment

**Platform:** Railway

**URL:** `https://stockly-backend-production.up.railway.app`

**Auto-deployment:** Pushes to `main` branch trigger automatic redeployment.

---

## ğŸ“„ License

MIT License

---

## ğŸ‘¨â€ğŸ’» Author

**Riad Benyamna**
- University of Southern Mississippi
- Computer Science Student
- Expected Graduation: May 2027

---

## âš–ï¸ Legal Disclaimer

This backend provides educational market data aggregation. Not financial advice. All investments carry risk of loss.
